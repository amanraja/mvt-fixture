# mvt-fixtures

[![Build Status](https://travis-ci.org/mapbox/mvt-fixtures.svg?branch=master)](https://travis-ci.org/mapbox/mvt-fixtures)

A [`require()`able](#require-fixtures) suite of [valid](#valid-fixtures) & [invalid](#invalid-fixtures) vector tile fixtures for testing [Mapbox Vector Tile](https://github.com/mapbox/vector-tile-spec) encoders and decoders. You can view a list of all fixtures at [FIXTURES.md](FIXTURES.md).

# Usage

mvt-fixtures can be used in two distinct ways, either by using the Javascript interface to generate fixtures on the fly or by using the raw fixtures directly via the /fixtures directory. The JS api is recommended if you are working in Javascript or Node.js. The raw fixtures are provided for those using this outside of a Javascript application. The general recommended workflow is to have your encoder or decoder loop through every fixture and either expect to successfully decode/encode valid fixtures, or fail to decode/encode invalid fixtures. When new fixtures are added to this repository, you simply need to update the version of the module (or your submodule) and re-run tests.

### Javascript usage

Check out the full Javascript interface over at [API.md](API.md)

```shell
npm install @mapbox/mvt-fixtures --save-dev
```

```javascript
const mvtf = require('@mapbox/mvt-fixtures');
const decoder = require('your-mvt-decoder');

mvtf.each(function(fixture) {
  let output = decoder(fixture.buffer);
  assert.equal(output.layers.length, fixture.json.layers.length, 'expected number of layers');
  // ... more tests
});
```

### Non-JS interface

You can access all of the fixtures and their metadata in the /fixtures directory. You can download this repository and get them manually, or use this repository as a submodule. Each fixture is named by the directory /fixtures/{name} and has the following files:

1. tile.mvt - the protocol buffer that represents (or intentionally breaks) the Mapbox Vector Tile specification
1. tile.json - a JSON representation of the tile and its properties
1. info.json - information about the fixture including `name`, `description`, and `specification_reference`.

# Develop

### Adding a new fixture

All fixtures have a source file in the /src directory. This file is a module that exports an object with the following parameters:

```javascript
module.exports = function(schema) {
  return {
    name: 'NAME',
    description: 'DESCRIPTION',
    specification_reference: 'SPECIFICATION_URL',
    json: {...},
    manipulate: function(buffer) {
      // function to further manipulate the buffer
      return buffer;
    }
  }
};
```

A new fixture template, which will exist in /src, can be created by running:

```
usage:
  npm run new <name>

example:
  npm run new invalid-no-layers
```

### Building fixtures

To rebuild all of the raw fixtures (including the tile.mvt, tile.json, and info.json files) in /fixtures you can run:

```
npm run build
```

### Building docs

Documentation takes two forms...

1. Javascript API docs in API.md
1. Fixture reference in FIXTURES.md

These can be generated by running:

```
npm run docs
```

### Running tests

All tests can be run with:

```
npm test
```
